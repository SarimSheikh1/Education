# We'll overwrite the user's files with updated versions that add:
# - Light/Dark theme toggle with persistence
# - New color palette + smooth transitions
# - Daily goal tracker and progress bar (20 reviews/day)
# - Word of the day in Profile
# - Course progress bars
# Then we'll display a short confirmation and provide download links.


index_html = """<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>LingoSpark — Micro-courses & Flashcards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="header-row">
      <h1>LingoSpark</h1>
      <div class="right-tools">
        <button id="theme-toggle" class="chip" aria-label="Toggle theme">Light</button>
      </div>
    </div>
    <nav class="tabs">
      <button class="tab-btn" data-tab="courses">Courses</button>
      <button class="tab-btn" data-tab="flashcards">Flashcards</button>
      <button class="tab-btn" data-tab="quiz">Quiz</button>
      <button class="tab-btn" data-tab="profile">Profile</button>
    </nav>
  </header>

  <main id="view">
    <!-- Courses -->
    <section id="tab-courses" class="tab is-active">
      <div class="section-head">
        <h2>Courses</h2>
        <p class="muted">Quick lessons with phrases and vocabulary.</p>
      </div>
      <div id="course-list" class="grid"></div>
      <article id="lesson" class="panel hidden"></article>
    </section>

    <!-- Flashcards -->
    <section id="tab-flashcards" class="tab">
      <div class="section-head">
        <h2>Flashcards</h2>
        <p class="muted">Due cards are scheduled with spaced repetition.</p>
      </div>
      <div class="flex-row gap wrap">
        <div class="panel flex-1" id="flashcard-panel">
          <div id="fc-stats" class="muted small"></div>
          <div id="flashcard" class="flashcard">
            <div id="flashcard-front" class="face"></div>
            <div id="flashcard-back" class="face hidden"></div>
          </div>
          <div class="fc-actions">
            <button id="btn-show" class="btn">Show answer</button>
            <div id="grade-row" class="hidden">
              <button class="btn danger" data-grade="2">Again</button>
              <button class="btn warn" data-grade="3">Hard</button>
              <button class="btn ok" data-grade="4">Good</button>
              <button class="btn success" data-grade="5">Easy</button>
            </div>
          </div>
        </div>

        <div class="panel" id="add-card-panel">
          <h3>Add custom card</h3>
          <label class="stack">
            <span>Front (target language)</span>
            <input id="new-front" placeholder="Hola" />
          </label>
          <label class="stack">
            <span>Back (your language)</span>
            <input id="new-back" placeholder="Hello" />
          </label>
          <button id="btn-add-card" class="btn">Add to deck</button>
          <p class="muted small" id="add-card-msg"></p>
        </div>
      </div>
    </section>

    <!-- Quiz -->
    <section id="tab-quiz" class="tab">
      <div class="section-head">
        <h2>Quiz</h2>
        <p class="muted">10 quick questions from the course vocabulary.</p>
      </div>
      <div class="panel" id="quiz-panel">
        <div id="quiz-status" class="muted small"></div>
        <div id="quiz-question" class="quiz-q"></div>
        <div id="quiz-choices" class="quiz-choices"></div>
        <div id="quiz-controls">
          <button id="btn-start-quiz" class="btn">Start quiz</button>
          <button id="btn-next" class="btn hidden">Next</button>
        </div>
      </div>
    </section>

    <!-- Profile -->
    <section id="tab-profile" class="tab">
      <div class="section-head">
        <h2>Profile</h2>
        <p class="muted">Your streak and progress are stored on this device.</p>
      </div>
      <div class="grid">
        <div class="panel">
          <h3>Daily streak</h3>
          <p id="streak-line" class="big"></p>
        </div>
        <div class="panel">
          <h3>Deck summary</h3>
          <ul id="deck-summary" class="list"></ul>
        </div>
        <div class="panel">
          <h3>Daily Goal</h3>
          <p class="muted small">Complete at least <strong>20</strong> reviews today.</p>
          <progress id="daily-goal" value="0" max="20"></progress>
          <p id="goal-msg" class="small"></p>
        </div>
        <div class="panel">
          <h3>Word of the Day</h3>
          <p id="word-of-day" class="big"></p>
          <p id="word-meaning" class="muted"></p>
        </div>
        <div class="panel">
          <h3>Data</h3>
          <button id="btn-export" class="btn">Export</button>
          <button id="btn-import" class="btn">Import</button>
          <input type="file" id="import-file" class="hidden" accept="application/json" />
          <p class="muted small">Export to back up, import to restore or move devices.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <span class="muted small">LingoSpark • Local-only demo • v1.1</span>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
"""

styles_css = """:root {
  /* Dark theme defaults */
  --bg: #0f172a;
  --panel: #1e293b;
  --ink: #f1f5f9;
  --muted: #94a3b8;
  --accent: #7c3aed;
  --accent-2: #14b8a6;
  --warn: #f59e0b;
  --danger: #ef4444;
  --ok: #38bdf8;
  --radius: 12px;
  --border: rgba(255,255,255,0.08);
}

:root.light {
  --bg: #f8fafc;
  --panel: #ffffff;
  --ink: #0f172a;
  --muted: #475569;
  --accent: #4f46e5;
  --accent-2: #0ea5e9;
  --warn: #d97706;
  --danger: #dc2626;
  --ok: #0891b2;
  --border: rgba(2,6,23,0.08);
}

* { box-sizing: border-box; }
html, body { margin: 0; padding: 0; }
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  background: linear-gradient(180deg, var(--bg) 0%, color-mix(in oklab, var(--bg) 80%, black 20%) 100%);
  color: var(--ink);
  min-height: 100vh;
  display: flex; flex-direction: column;
  transition: background 0.3s ease, color 0.3s ease;
}

.app-header, .app-footer {
  padding: 16px 20px;
  background: color-mix(in oklab, var(--bg) 90%, black 10%);
  border-bottom: 1px solid var(--border);
}
.app-footer { border-top: 1px solid var(--border); border-bottom: none; margin-top: auto; }

.header-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; }

h1 { font-size: 20px; margin: 0 0 8px; }
h2 { margin: 0 0 4px; }
h3 { margin: 0 0 8px; }
.big { font-size: 22px; margin: 0; }
.small { font-size: 13px; }
.muted { color: var(--muted); }
.hidden { display: none !important; }

.tabs { display: flex; gap: 8px; flex-wrap: wrap; }
.tab-btn {
  background: var(--panel); color: var(--ink);
  border: 1px solid var(--border); border-radius: 999px;
  padding: 8px 12px; cursor: pointer;
  transition: transform .1s ease, background .2s ease;
}
.tab-btn:hover { transform: translateY(-1px); }
.tab-btn.active { background: var(--accent); border-color: transparent; color: white; }

#view { padding: 16px 20px; }
.tab { display: none; }
.tab.is-active { display: block; }

.section-head { margin: 6px 0 16px; }
.grid {
  display: grid; gap: 12px;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
}
.flex-row { display: flex; align-items: stretch; }
.flex-1 { flex: 1; }
.gap { gap: 12px; }
.wrap { flex-wrap: wrap; }

.panel {
  background: var(--panel); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  transition: transform .15s ease, box-shadow .2s ease;
}
.panel:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }

.card {
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: color-mix(in oklab, var(--panel) 90%, black 10%);
  padding: 14px;
}
.card h3 { margin: 0 0 8px; }
.card .muted { margin: 4px 0 0; }

.btn {
  background: var(--accent); color: white;
  border: none; border-radius: 10px;
  padding: 8px 12px; cursor: pointer;
  transition: transform .1s ease, filter .2s ease, background .2s ease;
}
.btn:hover { transform: translateY(-1px); filter: brightness(1.05); }
.btn.success { background: var(--accent-2); color: #04261f; }
.btn.warn { background: var(--warn); color: #271b00; }
.btn.danger { background: var(--danger); color: #240a0a; }
.btn.ok { background: var(--ok); color: #081426; }

.list { margin: 0; padding-left: 18px; }
.stack { display: grid; gap: 6px; margin: 8px 0; }
input { background: color-mix(in oklab, var(--panel) 85%, black 15%); color: var(--ink); border: 1px solid var(--border); border-radius: 8px; padding: 8px; }

.flashcard {
  margin-top: 8px;
  border: 1px solid var(--border); border-radius: 14px;
  min-height: 160px; display: grid; place-items: center;
  padding: 18px; text-align: center;
  background: color-mix(in oklab, var(--panel) 90%, black 10%);
}
.flashcard .face { font-size: 26px; }
.fc-actions { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
#grade-row { display: flex; gap: 8px; }

.quiz-q { font-size: 20px; margin: 8px 0 12px; }
.quiz-choices { display: grid; gap: 8px; }
.quiz-choices .choice { text-align: left; }
.quiz-choices .choice.correct { outline: 2px solid var(--accent-2); }
.quiz-choices .choice.wrong { outline: 2px solid var(--danger); }

a, a:visited { color: var(--ok); }

progress {
  width: 100%;
  height: 12px;
  -webkit-appearance: none;
  appearance: none;
}
progress::-webkit-progress-bar {
  background: color-mix(in oklab, var(--panel) 80%, black 20%);
  border-radius: 999px;
}
progress::-webkit-progress-value {
  background: var(--accent-2);
  border-radius: 999px;
}
progress::-moz-progress-bar {
  background: var(--accent-2);
  border-radius: 999px;
}

.chip {
  background: var(--panel);
  color: var(--ink);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 6px 10px;
  cursor: pointer;
}
"""

app_js = """// LingoSpark — Micro-courses & Flashcards (local-only demo)
// Data + state are stored in localStorage.
// You can extend COURSE_DATA to add more lessons and vocab.

const STORAGE_KEY = "lingospark_v1";
const THEME_KEY = "lingospark_theme";
const DAILY_GOAL = 20;

const COURSE_DATA = [
  {
    id: "spanish-basics-1",
    lang: "Spanish",
    title: "Spanish Basics 1",
    description: "Greetings, simple phrases, and essential verbs.",
    lessons: [
      {
        id: "greetings",
        title: "Greetings",
        content: [
          ["Hola", "Hello"],
          ["Buenos días", "Good morning"],
          ["Buenas tardes", "Good afternoon"],
          ["Buenas noches", "Good evening/night"],
          ["¿Cómo estás?", "How are you?"],
          ["Muy bien", "Very well"],
          ["Gracias", "Thank you"],
          ["Por favor", "Please"],
          ["Adiós", "Goodbye"],
        ],
      },
      {
        id: "introductions",
        title: "Introductions",
        content: [
          ["Me llamo…", "My name is…"],
          ["¿Cómo te llamas?", "What is your name?"],
          ["Mucho gusto", "Nice to meet you"],
          ["¿De dónde eres?", "Where are you from?"],
          ["Soy de…", "I am from…"],
        ],
      },
      {
        id: "basics",
        title: "Basics",
        content: [
          ["Sí", "Yes"],
          ["No", "No"],
          ["Perdón", "Sorry"],
          ["No entiendo", "I don’t understand"],
          ["¿Puedes repetir?", "Can you repeat?"],
          ["¿Dónde está el baño?", "Where is the bathroom?"],
          ["Quiero", "I want"],
          ["Necesito", "I need"],
          ["Tengo", "I have"],
          ["¿Cuánto cuesta?", "How much is it?"],
        ],
      },
    ],
  },
];

function todayISO() {
  const d = new Date();
  d.setHours(0, 0, 0, 0);
  return d.toISOString();
}

function nowISO() {
  return new Date().toISOString();
}

function loadState() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (raw) {
    try { return JSON.parse(raw); } catch (_) {}
  }
  // First-time state
  const cards = [];
  COURSE_DATA.forEach(course => {
    course.lessons.forEach(lesson => {
      lesson.content.forEach(([front, back], idx) => {
        cards.push({
          id: `${course.id}:${lesson.id}:${idx}`,
          courseId: course.id,
          front, back,
          ease: 2.5,      // SM-2 default
          interval: 0,    // in days
          repetitions: 0,
          dueISO: nowISO(),
          createdISO: nowISO(),
          lapses: 0,
        });
      });
    });
  });

  return {
    version: 2,
    user: {
      name: "Learner",
      streak: 0,
      lastStudyDayISO: null,
    },
    coursesProgress: {},  // { [courseId]: { completedLessons: [] } }
    cards,
    stats: { reviews: 0, correct: 0, wrong: 0, reviewsToday: 0, lastReviewDayISO: null },
    ui: { theme: "dark" },
  };
}

let STATE = loadState();

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(STATE));
}

// --- Daily rollover
function ensureDailyRollover() {
  const today = todayISO();
  if (STATE.stats.lastReviewDayISO !== today) {
    STATE.stats.reviewsToday = 0;
    STATE.stats.lastReviewDayISO = today;
    saveState();
  }
}

// --- Streak tracking
function bumpStreak() {
  const today = new Date(todayISO()).getTime();
  const last = STATE.user.lastStudyDayISO ? new Date(STATE.user.lastStudyDayISO).getTime() : null;

  if (last === null) {
    STATE.user.streak = 1;
  } else if (today === last) {
    // same day, nothing
  } else {
    const diffDays = Math.round((today - last) / (1000 * 60 * 60 * 24));
    if (diffDays === 1) STATE.user.streak += 1;
    else STATE.user.streak = 1;
  }
  STATE.user.lastStudyDayISO = todayISO();
  saveState();
}

// --- SM-2 simplified scheduling
// q: 0..5 (we use 2,3,4,5)
function schedule(card, q) {
  const minEase = 1.3;
  const now = new Date();

  // Update ease
  let ease = card.ease + (0.1 - (5 - q) * (0.08 + (5 - q) * 0.02));
  if (ease < minEase) ease = minEase;

  if (q < 3) {
    card.repetitions = 0;
    card.interval = 1; // retry tomorrow
    card.lapses = (card.lapses || 0) + 1;
  } else {
    card.repetitions += 1;
    if (card.repetitions === 1) card.interval = 1;
    else if (card.repetitions === 2) card.interval = 6;
    else card.interval = Math.round(card.interval * ease);
  }

  card.ease = ease;
  const next = new Date(now.getTime() + card.interval * 24 * 60 * 60 * 1000);
  card.dueISO = next.toISOString();

  // stats
  ensureDailyRollover();
  STATE.stats.reviews += 1;
  if (q >= 4) STATE.stats.correct += 1; else STATE.stats.wrong += 1;
  STATE.stats.reviewsToday += 1;
  return card;
}

function isDue(card) {
  return new Date(card.dueISO) <= new Date();
}

function dueCounts() {
  const all = STATE.cards.filter(c => c.courseId === "spanish-basics-1" || c.courseId === "custom");
  const due = all.filter(isDue);
  return { due: due.length, total: all.length };
}

// --- UI helpers
function $(sel) { return document.querySelector(sel); }
function $all(sel) { return Array.from(document.querySelectorAll(sel)); }
function el(tag, attrs = {}, children = []) {
  const node = document.createElement(tag);
  Object.entries(attrs).forEach(([k, v]) => {
    if (k === "class") node.className = v;
    else if (k === "html") node.innerHTML = v;
    else node.setAttribute(k, v);
  });
  children.forEach(c => node.appendChild(c));
  return node;
}

// --- Tabs
function setActiveTab(name) {
  $all(".tab").forEach(t => t.classList.remove("is-active"));
  $(`#tab-${name}`).classList.add("is-active");
  $all(".tab-btn").forEach(b => b.classList.remove("active"));
  document.querySelector(`.tab-btn[data-tab="${name}"]`).classList.add("active");

  if (name === "flashcards") renderFlashcards();
  if (name === "courses") renderCourseList();
  if (name === "quiz") prepareQuizUI();
  if (name === "profile") renderProfile();
}

// --- Courses
function courseProgress(courseId) {
  const cp = STATE.coursesProgress[courseId]?.completedLessons || [];
  const total = COURSE_DATA.find(c => c.id === courseId).lessons.length;
  return { completed: cp.length, total, pct: Math.round((cp.length / total) * 100) };
}

function renderCourseList() {
  const wrap = $("#course-list");
  wrap.innerHTML = "";
  COURSE_DATA.forEach(course => {
    const { completed, total, pct } = courseProgress(course.id);

    const card = el("div", { class: "card" });
    card.appendChild(el("h3", { html: `${course.title}` }));
    card.appendChild(el("p", { class: "muted", html: course.description }));
    const meta = el("p", { class: "muted small", html: `${completed}/${total} lessons completed` });
    const bar = el("progress", { value: String(pct), max: "100", style: "width:100%;margin:6px 0;" });
    card.appendChild(meta);
    card.appendChild(bar);

    const list = el("div", { class: "list" });
    course.lessons.forEach(lsn => {
      const done = (STATE.coursesProgress[course.id]?.completedLessons || []).includes(lsn.id);
      const btn = el("button", { class: "btn", html: `${done ? "Review" : "Open"}: ${lsn.title}` });
      btn.addEventListener("click", () => openLesson(course, lsn));
      list.appendChild(el("div", {}, [btn]));
    });
    card.appendChild(list);
    wrap.appendChild(card);
  });
  $("#lesson").classList.add("hidden");
}

function openLesson(course, lesson) {
  const view = $("#lesson");
  view.classList.remove("hidden");
  view.innerHTML = "";

  view.appendChild(el("h3", { html: `${course.title} — ${lesson.title}` }));

  const tbl = el("div", { class: "list" });
  lesson.content.forEach(([front, back]) => {
    const row = el("div", { class: "flex-row gap" });
    row.appendChild(el("div", { class: "panel flex-1", html: `<strong>${front}</strong><br/><span class="muted">${back}</span>` }));
    tbl.appendChild(row);
  });
  view.appendChild(tbl);

  const done = el("button", { class: "btn ok", html: "Mark lesson complete" });
  done.addEventListener("click", () => {
    const cp = STATE.coursesProgress[course.id] || { completedLessons: [] };
    if (!cp.completedLessons.includes(lesson.id)) cp.completedLessons.push(lesson.id);
    STATE.coursesProgress[course.id] = cp;
    bumpStreak();
    saveState();
    renderCourseList();
    alert("Nice! Lesson marked complete.");
  });
  view.appendChild(el("div", { style: "margin-top:10px" }, [done]));
}

// --- Flashcards
let currentCard = null;

function pickDueCard() {
  const due = STATE.cards.filter(isDue);
  if (due.length === 0) return null;
  // simple: pick the oldest due
  due.sort((a, b) => new Date(a.dueISO) - new Date(b.dueISO));
  return due[0];
}

function renderFlashcards() {
  ensureDailyRollover();
  const statsDiv = $("#fc-stats");
  const { due, total } = dueCounts();
  statsDiv.textContent = `Due: ${due} / ${total} • Reviews total: ${STATE.stats.reviews} • Today: ${STATE.stats.reviewsToday}/${DAILY_GOAL}`;

  currentCard = pickDueCard();

  const front = $("#flashcard-front");
  const back = $("#flashcard-back");
  const showBtn = $("#btn-show");
  const gradeRow = $("#grade-row");

  if (!currentCard) {
    front.textContent = "All caught up!";
    back.textContent = "";
    back.classList.add("hidden");
    showBtn.classList.add("hidden");
    gradeRow.classList.add("hidden");
    return;
  }

  front.textContent = currentCard.front;
  back.textContent = currentCard.back;

  back.classList.add("hidden");
  showBtn.classList.remove("hidden");
  gradeRow.classList.add("hidden");
}

function bindFlashcardControls() {
  $("#btn-show").addEventListener("click", () => {
    $("#flashcard-back").classList.remove("hidden");
    $("#grade-row").classList.remove("hidden");
    $("#btn-show").classList.add("hidden");
  });

  $all('#grade-row .btn').forEach(btn => {
    btn.addEventListener("click", (e) => {
      const q = Number(e.target.getAttribute("data-grade"));
      if (!currentCard) return;

      schedule(currentCard, q);
      bumpStreak();
      saveState();
      renderFlashcards();
      renderProfile(); // keep profile goal in sync
    });
  });

  $("#btn-add-card").addEventListener("click", () => {
    const f = $("#new-front").value.trim();
    const b = $("#new-back").value.trim();
    const msg = $("#add-card-msg");
    if (!f || !b) {
      msg.textContent = "Please fill both fields.";
      return;
    }
    STATE.cards.push({
      id: `custom:${Date.now()}`,
      courseId: "custom",
      front: f, back: b,
      ease: 2.5, interval: 0, repetitions: 0,
      dueISO: nowISO(), createdISO: nowISO(), lapses: 0,
    });
    $("#new-front").value = ""; $("#new-back").value = "";
    msg.textContent = "Added. It will appear in your due queue.";
    saveState();
    renderFlashcards();
  });
}

// --- Quiz
let QUIZ = null;

function buildVocabPool() {
  const pool = [];
  COURSE_DATA.forEach(c =>
    c.lessons.forEach(lsn =>
      lsn.content.forEach(([front, back]) => pool.push({ front, back, courseId: c.id }))
    )
  );
  return pool;
}

function prepareQuizUI() {
  $("#quiz-status").textContent = "Press Start to begin.";
  $("#quiz-question").textContent = "";
  $("#quiz-choices").innerHTML = "";
  $("#btn-next").classList.add("hidden");
  $("#btn-start-quiz").classList.remove("hidden");
}

function startQuiz() {
  const pool = buildVocabPool();
  // pick 10 random
  const items = [...pool].sort(() => Math.random() - 0.5).slice(0, 10);
  QUIZ = {
    idx: 0,
    score: 0,
    items,
  };
  renderQuizQ();
}

function renderQuizQ() {
  const item = QUIZ.items[QUIZ.idx];
  $("#quiz-status").textContent = `Question ${QUIZ.idx + 1} of ${QUIZ.items.length} • Score: ${QUIZ.score}`;

  $("#quiz-question").textContent = `What is the meaning of: "${item.front}"?`;

  const distractors = buildVocabPool()
    .filter(it => it.back !== item.back)
    .sort(() => Math.random() - 0.5)
    .slice(0, 3)
    .map(it => it.back);

  const options = [...distractors, item.back].sort(() => Math.random() - 0.5);
  const choices = $("#quiz-choices");
  choices.innerHTML = "";
  options.forEach(opt => {
    const btn = el("button", { class: "btn choice", html: opt });
    btn.addEventListener("click", () => {
      $all(".choice").forEach(b => b.disabled = true);
      if (opt === item.back) {
        btn.classList.add("correct");
        QUIZ.score += 1;
      } else {
        btn.classList.add("wrong");
        // highlight correct
        $all(".choice").forEach(b => { if (b.textContent === item.back) b.classList.add("correct"); });
      }
      $("#btn-next").classList.remove("hidden");
      bumpStreak();
      saveState();
    });
    choices.appendChild(btn);
  });

  $("#btn-next").onclick = () => {
    QUIZ.idx += 1;
    if (QUIZ.idx >= QUIZ.items.length) {
      $("#quiz-status").textContent = `Done! Final score: ${QUIZ.score}/${QUIZ.items.length}`;
      $("#quiz-question").textContent = "Great work.";
      $("#quiz-choices").innerHTML = "";
      $("#btn-next").classList.add("hidden");
      $("#btn-start-quiz").classList.remove("hidden");
      renderProfile();
    } else {
      renderQuizQ();
      $("#btn-next").classList.add("hidden");
    }
  };
}

// --- Profile
function renderProfile() {
  ensureDailyRollover();
  const s = STATE.user.streak || 0;
  $("#streak-line").textContent = `${s} day${s === 1 ? "" : "s"} in a row`;

  const { due, total } = dueCounts();
  $("#deck-summary").innerHTML = `
    <li>Total cards: ${total}</li>
    <li>Due now: ${due}</li>
    <li>Lifetime reviews: ${STATE.stats.reviews}</li>
    <li>Correct: ${STATE.stats.correct}, Wrong: ${STATE.stats.wrong}</li>
  `;

  // Daily goal
  const prog = $("#daily-goal");
  const msg = $("#goal-msg");
  prog.value = STATE.stats.reviewsToday;
  msg.textContent = `${STATE.stats.reviewsToday}/${DAILY_GOAL} reviews today`;
  if (STATE.stats.reviewsToday >= DAILY_GOAL) {
    msg.textContent += " • Goal met 🎯";
  }

  // Word of the day
  const pool = buildVocabPool();
  if (pool.length) {
    const seed = new Date().toISOString().slice(0,10);
    const index = seed.split("-").reduce((a,b)=>a+parseInt(b),0) % pool.length;
    const word = pool[index];
    $("#word-of-day").textContent = word.front;
    $("#word-meaning").textContent = word.back;
  }
}

// --- Export/Import
function exportData() {
  const data = JSON.stringify(STATE, null, 2);
  const blob = new Blob([data], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "lingospark-export.json";
  a.click();
  URL.revokeObjectURL(url);
}

function importData(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const obj = JSON.parse(e.target.result);
      if (!obj || !obj.cards) throw new Error("Invalid file");
      STATE = obj;
      saveState();
      setActiveTab("profile");
      alert("Import successful.");
      applyTheme(STATE.ui?.theme || 'dark');
    } catch (err) {
      alert("Import failed: " + err.message);
    }
  };
  reader.readAsText(file);
}

// --- Theme
function applyTheme(mode) {
  const root = document.documentElement;
  if (mode === "light") root.classList.add("light");
  else root.classList.remove("light");
  STATE.ui.theme = mode;
  localStorage.setItem(THEME_KEY, mode);
  const toggle = $("#theme-toggle");
  if (toggle) toggle.textContent = mode === "light" ? "Dark" : "Light";
}

function bindThemeToggle() {
  const btn = $("#theme-toggle");
  btn.addEventListener("click", () => {
    const next = (STATE.ui.theme === "light") ? "dark" : "light";
    applyTheme(next);
  });
}

// --- Event bindings
function bindTabs() {
  $all(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => setActiveTab(btn.dataset.tab));
  });
}

function bindQuizButtons() {
  $("#btn-start-quiz").addEventListener("click", () => {
    startQuiz();
    $("#btn-start-quiz").classList.add("hidden");
  });
}

function bindExportImport() {
  $("#btn-export").addEventListener("click", exportData);
  $("#btn-import").addEventListener("click", () => $("#import-file").click());
  $("#import-file").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) importData(file);
  });
}

// --- Boot
function init() {
  ensureDailyRollover();
  bindTabs();
  bindFlashcardControls();
  bindQuizButtons();
  bindExportImport();
  bindThemeToggle();
  renderCourseList();
  // theme from storage
  const stored = localStorage.getItem(THEME_KEY) || STATE.ui.theme || 'dark';
  applyTheme(stored);
  setActiveTab("courses");
}

document.addEventListener("DOMContentLoaded", init);
"""

# Write files
with open('/mnt/data/index.html', 'w', encoding='utf-8') as f:
    f.write(index_html)

with open('/mnt/data/styles.css', 'w', encoding='utf-8') as f:
    f.write(styles_css)

with open('/mnt/data/app.js', 'w', encoding='utf-8') as f:
    f.write(app_js)

print("Updated files written:\n- /mnt/data/index.html\n- /mnt/data/styles.css\n- /mnt/data/app.js")
